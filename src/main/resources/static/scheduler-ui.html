<html>
<head>
    <script src="/webjars/jquery/jquery.min.js"></script>
    <script src="/webjars/bootstrap/js/bootstrap.min.js"></script>
    <title>Scheduler任务调度中心控制台</title>
    <link rel="stylesheet" href="/webjars/bootstrap/css/bootstrap.min.css"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
</head>
<body>
<div class="container"><br/>
    <div>
        <img src="images/spring-boot.jpg" height="60" width="60">
        <img src="images/quartz.jpg" height="60" width="90">
        <img src="images/logo.png">
    </div>
    <br/>
    <div>
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#jobModal">新增</button>
    </div>
    <br/>
    <div class="table-responsive">
        <table class="table">
            <thead>
            <tr class="success">
                <th>任务</th>
                <th>任务组</th>
                <th>URL</th>
                <th>优先级</th>
                <th>操作</th>
            </tr>
            </thead>
            <tbody class="table-striped">
            </tbody>
        </table>

        <ul class="pager">
            <li><a href="#">Previous</a></li>
            <li><a href="#">Next</a></li>
        </ul>
    </div>
</div>

<div class="modal fade" id="jobModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel">新增</h4>
            </div>
            <form role="form">
                <div class="modal-body">
                    <label>任务</label>
                    <input type="text" class="form-control">
                    <label>任务组</label>
                    <input type="text" class="form-control">
                    <label>触发器</label>
                    <input type="text" class="form-control">
                    <label>触发器组</label>
                    <input type="text" class="form-control">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="addJob()">保存</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                </div>
            </form>
        </div>
    </div>
</div>

</body>

<script type="text/javascript">
    $(document).ready(function () {
        $.ajax({
            type: "get",
            url: "http://localhost:8080/api/v1/jobs",
            dataType: "json",
            success: function (data) {
                var item;
                $.each(data.jobs, function (i, result) {
                        item = "<tr>" +
                            "        <td>" + result['jobName'] + "</td>" +
                            "        <td>" + result['jobGroupName'] + "</td>" +
                            "        <td>" + result['url'] + "</td>" +
                            "        <td>" + result['priority'] + "</td>" +
                            "        <td>" +
                            "                    <div>\n" +
                            "                        <button type=\"button\" class=\"btn btn-primary\" onclick='delJob()'>删除</button>\n" +
                            "                        <button type=\"button\" class=\"btn btn-primary\"  data-toggle=\"modal\" data-target=\"#jobModal\">修改</button>\n" +
                            "                        <button type=\"button\" class=\"btn btn-primary\">暂停</button>\n" +
                            "                        <button type=\"button\" class=\"btn btn-primary\">恢复</button>\n" +
                            "                        <button type=\"button\" class=\"btn btn-primary\">立即启动</button>\n" +
                            "                    </div>\n" +
                            "        </td>" +
                            " </tr>";
                        $('.table-striped').append(item);
                    }
                );
            },
            error: function () {
                alert('系统异常')
            }
        })
    });

    /*添加job*/
    function addJob() {
        $.ajax({
            type: "POST",
            dataType: "json",
            url: "/users/login",
            data: $('form').serialize(),
            success: function (result) {
                console.log(result);
                if (result.status == 'ok') {
                    alert("SUCCESS");
                }
                ;
            },
            error: function () {
                alert("系统异常！");
            }
        });
    }
</script>
</html>
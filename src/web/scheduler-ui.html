<html>
<head>
    <script src="/webjars/jquery/jquery.min.js"></script>
    <script src="/webjars/bootstrap/js/bootstrap.min.js"></script>
    <title>Scheduler任务调度中心控制台</title>
    <link rel="stylesheet" href="/webjars/bootstrap/css/bootstrap.min.css"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
</head>
<body>
<div class="container"><br/>
    <div>
        <img src="webjars/scheduler-dashboard-ui/images/spring-boot.jpg" height="60" width="60">
        <img src="webjars/scheduler-dashboard-ui/images/quartz.jpg" height="60" width="90">
        <img src="webjars/scheduler-dashboard-ui/images/logo.png">
    </div>
    <br/>
    <div>
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#jobModal">新增</button>
    </div>
    <br/>
    <div class="table-responsive">
        <table class="table">
            <thead>
            <tr class="success">
                <th>任务</th>
                <th>任务组</th>
                <th>应用名称</th>
                <th>URI</th>
                <th>URL</th>
                <th>频率</th>
                <th>描述</th>
                <th>操作</th>
            </tr>
            </thead>
            <tbody class="table-striped">
            </tbody>
        </table>

        <ul class="pager">
            <li><a href="#">Previous</a></li>
            <li><a href="#">Next</a></li>
        </ul>
    </div>
</div>

<!-- 新增job div-->
<div class="modal fade" id="jobModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel">新增</h4>
            </div>
            <form role="form">
                <div class="modal-body">
                    <label>任务:</label>
                    <input id="jobName" type="text" class="form-control">
                    <label>任务组:</label>
                    <input id="jobGroupName" type="text" class="form-control">
                    <label>触发器:</label>
                    <input id="triggerName" type="text" class="form-control">
                    <label>触发器组:</label>
                    <input id="triggerGroupName" type="text" class="form-control">
                    <label>执行频率:</label>
                    <input id="cron" type="text" class="form-control">
                    <label>优先级:</label>
                    <select id="priority" class="selectpicker">
                        <option value="5">5</option>
                        <option value="6">6</option>
                    </select><br/>
                    <label>错失重发策略:</label>
                    <select id="misfire" class="selectpicker">
                        <option value="5">5</option>
                        <option value="6">6</option>
                    </select><br/>
                    <label>应用ID:</label>
                    <input id="applicationId" type="text" class="form-control">
                    <label>uri:</label>
                    <input id="uri" type="text" class="form-control">
                    <label>url:</label>
                    <input id="url" type="text" class="form-control">
                    <label>任务描述:</label>
                    <input id="jobDescription" type="text" class="form-control">
                    <label>触发器描述:</label>
                    <input id="triggerDescription" type="text" class="form-control">
                    <label>立即启动:</label>
                    <select id="startNow" class="selectpicker">
                        <option value="true">是</option>
                        <option value="false">否</option>
                    </select>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="addJob()">保存</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                </div>
            </form>
        </div>
    </div>
</div>

</body>

<script type="text/javascript">
    $(document).ready(function () {
        $.ajax({
            type: "get",
            url: "/api/v1/jobs",
            dataType: "json",
            success: function (data) {
                var item;
                $.each(data.jobs, function (i, result) {
                        item = "<tr>" +
                            "        <td>" + result['jobName'] + "</td>" +
                            "        <td>" + result['jobGroupName'] + "</td>" +
                            "        <td>" + result['applicationId'] + "</td>" +
                            "        <td>" + result['uri'] + "</td>" +
                            "        <td>" + result['url'] + "</td>" +
                            "        <td>" + result['cron'] + "</td>" +
                            "        <td>" + result['jobDescription'] + "</td>" +
                            "        <td>" +
                            "                    <div>\n" +
                            "                        <button type=\"button\" class=\"btn btn-primary\"  data-toggle=\"modal\" data-target=\"#jobModal\">修改</button>\n" +
                            "                        <button type=\"button\" class=\"btn btn-primary\" onclick='delJob()'>删除</button>\n" +
                            "                        <button type=\"button\" class=\"btn btn-primary\" onclick='pauseJob()'>暂停</button>\n" +
                            "                        <button type=\"button\" class=\"btn btn-primary\" onclick='resumeJob()'>恢复</button>\n" +
                            "                        <button type=\"button\" class=\"btn btn-primary\" onclick='startJob()'>立即启动</button>\n" +
                            "                    </div>\n" +
                            "        </td>" +
                            " </tr>";
                        $('.table-striped').append(item);
                    }
                );
            },
            error: function () {
                alert('系统异常')
            }
        })
    });

    /*添加job*/
    function addJob() {
        $.ajax({
            type: "POST",
            dataType: "json",
            url: "/api/v1/add",
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify(jobJson()),
            success: function (result) {
                console.log(result);
                alert(result.message)
            },
            error: function () {
                alert("系统异常！");
            }
        });
    }

    /*删除job*/
    function delJob() {
        $.ajax({
            type: "DELETE",
            dataType: "json",
            url: "/api/v1/delete/job/" + $("#jobName").val() + "/group/" + $("#jobGroupName").val(),
            contentType: "application/json; charset=utf-8",
            success: function (result) {
                console.log(result);
                alert(result.message);
            },
            error: function () {
                alert("系统异常！");
            }
        });
    }

    /*暂停job*/
    function pauseJob() {
        $.ajax({
            type: "PUT",
            dataType: "json",
            url: "/api/v1/pause/job/" + $("#jobName").val() + "/group/" + $("#jobGroupName").val(),
            contentType: "application/json; charset=utf-8",
            success: function (result) {
                console.log(result);
                alert(result.message);
            },
            error: function () {
                alert("系统异常！");
            }
        });
    }

    /*恢复job*/
    function resumeJob() {
        $.ajax({
            type: "PUT",
            dataType: "json",
            url: "/api/v1/resume/job/" + $("#jobName").val() + "/group/" + $("#jobGroupName").val(),
            contentType: "application/json; charset=utf-8",
            success: function (result) {
                console.log(result);
                alert(result.message);
            },
            error: function () {
                alert("系统异常！");
            }
        });
    }

    /*立即启动job*/
    function startJob() {
        $.ajax({
            type: "PUT",
            dataType: "json",
            url: "/api/v1/start/job/" + $("#jobName").val() + "/group/" + $("#jobGroupName").val(),
            contentType: "application/json; charset=utf-8",
            success: function (result) {
                console.log(result);
                alert(result.message);
            },
            error: function () {
                alert("系统异常！");
            }
        });
    }

    /*获取json*/
    function jobJson() {
        var json = {
            "jobName": $("#jobName").val(),
            "jobGroupName": $("#jobGroupName").val(),
            "triggerName": $("#triggerName").val(),
            "triggerGroupName": $("#triggerGroupName").val(),
            "cron": $("#cron").val(),
            "priority": $("#priority").val(),
            "misfire": $("#misfire").val(),
            "applicationId": $("#applicationId").val(),
            "uri": $("#uri").val(),
            "url": $("#url").val(),
            "jobDescription": $("#jobDescription").val(),
            "triggerDescription": $("#triggerDescription").val(),
            "startNow": $("#startNow").val()
        };
        return json;
    }
</script>
</html>